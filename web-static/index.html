<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
  
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-5774477604817329",
          enable_page_level_ads: true
     });
</script>

     <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Mining pool p2pool Litecoin LTC scrypt algo">
    <meta name="author" content="">
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
        
    <title>p2pool radiocoin</title>

    <link href="http://fonts.googleapis.com/css?family=Roboto:300,300italic,400,400italic,100,100italic,500,500italic,700,700italic,900,900italic" rel="stylesheet" type="text/css">
    <link href='http://fonts.googleapis.com/css?family=Roboto+Condensed:400italic,700italic,400,700' rel='stylesheet' type='text/css'>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/bootstrap-theme.min.css">
    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
    <link rel="stylesheet" href="css/bootstrap-sortable.css">

    <script src="js/jquery-2.0.3.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery-dateFormat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script>
    <script src="js/bootstrap-sortable.js"></script>

    <script src="js/highcharts.js"></script>
    <script src="js/exporting.js"></script>

    <script src="js/util.js"></script>
    <script src="js/graph.js"></script>

    <!-- Custom styles for this template -->
    <link href="grid.css" rel="stylesheet">

    <style type="text/css">
      body {
        font-family: 'Roboto', Helvetica, sans-serif;
        font-size: 14px;
      }
.blokimg {position: relative;}

.overlay{
  display: none;
  height: auto;
  left: -15%;
  position: absolute;
  top: -50%;
  width: auto;
  z-index: 999;
}
.overlay .overlay_container{
  display: table-cell;
  
  vertical-align: middle;
}
.overlay_container img{
  background-color: #5581BB;
  padding: 10px;
  -border-radius: 5px;
  -border-radius: 5px;
}
.overlay:target {
  display: table;
}
.button {
    background-color: #008CBA; 
    border: none;
    color: white;
    padding: 8px 16px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 14px;
    margin: 4px 2px;
    border-radius: 8px;
    cursor: pointer;
    box-shadow: 0 12px 16px 0 rgba(0,0,0,0.24),0 17px 50px 0 rgba(0,0,0,0.19);
}

.button:hover {
    background-color: #5581BB;
}
.disabled {
    opacity: 0.6;
    cursor: not-allowed;
}
.button span {
  cursor: pointer;
  display: inline-block;
  position: relative;
  transition: 0.5s;
}

.button span:after {
  content: '\00bb';
  position: absolute;
  opacity: 0;
  top: 0;
  right: -20px;
  transition: 0.5s;
}

  </style>

  </head>

  <body>
    <div id='ribbon'>
<a href="https://github.com/c4pt000/docker-p2pool-radiocoin" style="position: absolute; top: 0; right: 0; border: 0;" class="btn btn-default btn-lg btn-gh">
<i class="fa fa-github"></i>p2pool radiocoin GitHub</a>
    </div>
 

    <!--<div id='ribbon'>
      <a href="https://github.com/farsider350/node-stats">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="img/forkme_right_orange_ff7600.png" alt="Fork me on GitHub">
      </a>
    </div>-->

    <div class="container">
      <div class="page-header">
        <h1>p2pool radiocoin</h1>
<br>
<br>
<h3>cpu mining</h1>
<br>
<br>
<h5>wget https://raw.githubusercontent.com/c4pt000/radiocoin/master/LINODE-GPU-CLUSTER-script-FEDORA-34</h5>
<br>
<h5>docker run -it c4pt/cpuminer-opt cpuminer -a scrypt --url stratum+tcp://radiopool.me:9555 --userpass your-radiocoin-receiving-addr:x -t 24 --param-n --param-r --no-longpoll --coinbase-addr=your-radiocoin-receiving-addr --no-extranonce --no-getwork --no-gbt --no-stratum -q</h1>
<br>
<br>
<h5>set to -I 20 for stronger intensity...be warned</h1>
<h5>docker run -it --privileged c4pt/cudaminer-nvidia-docker cgminer --scrypt -I 13 -o stratum+tcp://radiopool.me:9555 --userpass your-radiocoin-receiving-addr:x --worksize 256 -g 1 --lookup-gap 2 --thread-concurrency 7200 --fix-protocol</h1>


        <p style="text-align: right"><b>
          <small>
            Node: <span class='node'></span>&nbsp;&dash;
            Updated: <span id='updated'></span>
          </small>
        </b></p>
      </div>
      <div id='node_alerts' class="alert alert-danger hidden"></div>

      <!-- We should have a possiblity showing other miners on our node what
           happened or if we have other things to tell them. -->
      <div class="alert alert-danger hidden">
          <p></p>
      </div>      

      <h4>Status</h4>
      <table id='status' class="table table-hover" border='0'>
        <tr>
          <td width='25%'>Local rate:</td>
          <td width='25%' class='text-right'><span id='local_rate'></span></td>
          <td width='25%'>Shares:</td>
          <td width='25%' class='text-right'><span id='shares'></span></td>
        </tr>
        <tr>
          <td width='25%'>Global pool rate:</td>
          <td width='25%' class='text-right'><span id='global_rate'></span></td>
          <td width='25%'>Share difficulty (pool minimum):</td>
          <td width='25%' class='text-right'><span id='share_difficulty'></span></td>
        </tr>
        <tr>
          <td width='25%'><span class='currency'></span> network hashrate (estimate):</td>
          <td width='25%' class='text-right'><span id='network_rate'></span></td>
          <td width='25%'>Network block difficulty:</td>
          <td width='25%' class='text-right'><span id='block_difficulty'></span></td>
        </tr>
        <tr>
          <td width='25%'>Current block value:</td>
          <td width='25%' class='text-right'><span id='block_value'></span></td>
          <td width='25%'>Expected time to share (this node):</td>
          <td width='25%' class='text-right'><span id='expected_time_to_share'></span></td>
        </tr>
        <tr>
        <!--  <td width='25%'>Payout if a block were found NOW:</td>
          <td width='25%' class='text-right'><span id='payout_now'></span></td>-->
          <td width='25%'>Node peers:</td>
          <td width='25%' class='text-right'>
            <i class='fa fa-sign-in fa-fw'></i>
            <span id='peers_in'></span>
            /
            <i class='fa fa-sign-out fa-fw'></i>
            <span id='peers_out'></span>
          </td>
          <td width='25%'>Expected time to block (pool):</td>
          <td width='25%' class='text-right'><span id='expected_time_to_block'></span></td>
        </tr>
        <tr>
          <td width='25%'>Node fee:</td>
          <td width='25%' class='text-right'><span id='node_fee'></span><!-- / <span id='node_donation'></span>--></td>
          <td width='25%'>Node uptime:</td>
          <td width='25%' class='text-right'><span id='node_uptime'></span></td>
        </tr>
        <tr>
          <td width='25%'>Node p2pool version:</td>
          <td width='25%' class='text-right'><span id='p2pool_version'></span></td>
          <td width='25%'>Protocol version:</td>
          <td width='25%' class='text-right'><span id='protocol_version'></span></td>
        </tr>
      </table>
      <div class="alert alert-danger hidden">
          <p></p>
      </div>
      <div class="alert alert-danger hidden">
      </div>
      <h4>Active miners on this node</h4>
      <table class="table table-hover sortable">
        <tbody id='active_miners'>
        </tbody>
      </table>
	<center>
        <div class='container'>
          <button id='hour' type="button" class="hashrate btn btn-info">Hour</button>
          <button id='day' type="button" class="hashrate btn btn-info">Day</button>
          <button id='week' type="button" class="hashrate btn btn-info">Week</button>
          <button id='month' type="button" class="hashrate btn btn-info">Month</button>
          <button id='year' type="button" class="hashrate btn btn-info">Year</button>
        </div>
      </center>
      <div id='graph'></div>
	  
      <h5 align="center"><a href="classic" target="_blank">Click here for more detailed stats
      and graphs (classic p2pool)</a></h5>
<br>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="fluid"
     data-ad-layout-key="-fb+5q+5c-de+5g"
     data-ad-client="ca-pub-5774477604817329"
     data-ad-slot="7347008451"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
<br>
      <h4>Recent blocks</h4>
      <table class="table table-hover">
        <thead><tr>
          <th>When</th>
          <th>Date/Time</th>
          <th>Number</th>
          <th>Hash</th>
          <!--<th>Confirmations</th>-->
        </tr></thead>
        <tbody id='recent_blocks'>
        </tbody>
      </table>

    </div> <!-- /container -->
    <script type="text/javascript">

    $(document).ready(function() {
      $(document).trigger('init');
    });

    // reload timers 
    var intervalFigures = 30;
    var intervalGraph = 600;
    
    // array defining my addresses for highlighting them
    var myself= [ ];

    var currency, currency_info, rate, local_stats,
        global_stats, current_payouts, recent_blocks;
    var local_hashrate= 0, local_doa_hashrate= 0;

    // ==================================================================
    // event handlers

    $('#hour.hashrate').click(function(e) {
      fetchGraph('hour');
    });
    $('#day.hashrate').click(function(e) {
      fetchGraph('day');
    });
    $('#week.hashrate').click(function(e) {
      fetchGraph('week');
    });
    $('#month.hashrate').click(function(e) {
      fetchGraph('month');
    });
    $('#year.hashrate').click(function(e) {
      fetchGraph('year');
    });

    // ==================================================================
    // custom event handlers

    // init

    $(document).on('init', function(e, eventInfo) {
      fetchdata(); fetchBlocks(); fetchGraph('day');
    });

    $(document).on('update', function(e, eventInfo) {
      fetchdata();
      d=new Date()
      if (((d.getMinutes() * 60 + d.getSeconds()) % intervalGraph) < intervalFigures) {
        fetchBlocks();
        graphPeriod=char.title.text.match(/\((.+)\)/)[1] || 'day';
        fetchGraph(graphPeriod);
      };
    });

    // Fills the list of active miners on this node.  I know, there are
    // zillions of people out there on p2pool.  But I'm typically only
    // interested to see, who is mining on my node.

    $(document).on('update_miners', function(e, eventInfo) {
      local_hashrate= 0; local_doa_hashrate= 0;

      backend_plus = ((typeof local_stats.miner_last_difficulties !== 'undefined') ? true : false);

      if (backend_plus) {
        $('#plus1').removeClass('hidden');      
        $('#plus2').removeClass('hidden');
      } else {
        $('#plus1').addClass('hidden');
        $('#plus2').addClass('hidden');
      }
  $('#active_miners').empty();
      
      $.each(local_stats.miner_hash_rates, function(address, hashrate) {
        tr= $('<tr/>').attr('id', address);
        tr= $('<img/>').attr('src', "./img/fuzz-address.png");
        // highlight our miner if configured
        if(myself && myself.length > 0 && $.inArray(address, myself) >= 0) {
          tr.addClass('warning');
        }


        link_icon= $('<i/>').attr('class', 'fa fa-external-link fa-fw');
        blockinfo= $('<a/>')
          .attr('href', currency_info.address_explorer_url_prefix + address)
          .attr('target', '_blank').append(link_icon);

        doa= local_stats.miner_dead_hash_rates[address] || 0;
        doa_prop= (parseFloat(doa) / parseFloat(hashrate)) * 100;
        
        local_hashrate+= hashrate;
        local_doa_hashrate+= doa;

        tr.append($('<td/>').attr('class', 'text-left')
          .html(address + '&nbsp;').append(blockinfo));
        tr.append($('<td/>').attr('class', 'text-right')
          .append(formatHashrate(hashrate)));
        tr.append($('<td/>').attr('class', 'text-right')
          .append(formatHashrate(doa) + ' (' + doa_prop.toFixed(2) + '%)'));

        if (backend_plus) {
          diff = parseFloat(local_stats.miner_last_difficulties[address]) || 0;
          
          time_to_share = (parseInt(local_stats.attempts_to_share) / parseInt(hashrate)
           * (diff / parseFloat(global_stats.min_difficulty))) || 0;
           
          diff = diff.toFixed(3) + ' (' + formatInt(diff*65536) + ')';
          time_to_share = (''+time_to_share).formatSeconds();

          tr.append($('<td/>').attr('class', 'text-right')
           .append(diff));

          tr.append($('<td/>').attr('class', 'text-right')
           .append(time_to_share));
        }

        payout= current_payouts[address];

        if(payout) {
          td= $('<td/>').attr('class', 'text-right')
            .text(parseFloat(payout).toFixed(8))
            .append(' ').append(currency.clone());
          tr.append(td);
        }
        else {
          tr.append($('<td/>').attr('class', 'text-right')
            .append($('<i/>').append('no shares yet')));
        }
        //$('#'+address).remove();
        $('#active_miners').append(tr);
      });

      $.bootstrapSortable({ applyLast: true });

      rate= formatHashrate(local_hashrate)
        + ' (DOA '
        + formatHashrate(local_doa_hashrate)
        + ' / ' + ((local_doa_hashrate / local_hashrate) * 100).toFixed(2)
        + '%)';
      //dr="[debug: "+local_hashrate+" "+local_doa_hashrate+"]";        
      $('#local_rate').text(rate);

      global_doa_rate= global_stats.pool_hash_rate - global_stats.pool_nonstale_hash_rate;
      global_rate= formatHashrate(global_stats.pool_hash_rate)
        + ' (DOA '
        + formatHashrate(global_doa_rate)
        + ' / ' + ((global_doa_rate / global_stats.pool_hash_rate) * 100).toFixed(2)
        + '%)';
      $('#global_rate').text(global_rate);

      $('#network_rate').text(formatHashrate(global_stats.network_hashrate));

      block_diff = global_stats.network_block_difficulty;
      if (typeof block_diff !== 'undefined') {
        block_diff = block_diff.toFixed(3) + ' (' + formatInt(block_diff*65536) + ')';
      } else {
        block_diff = 'n/a';
      }
      $('#block_difficulty').text(block_diff);
      

      share_diff=parseFloat(global_stats.min_difficulty);
      $('#share_difficulty').text(share_diff.toFixed(3) +
        ' (' + formatInt(share_diff*65536) + ')');

      $('#block_value')
        .text(parseFloat(local_stats.block_value).toFixed(8))
        .append(' ').append(currency.clone());

      $('#node_donation')
        .text((local_stats.donation_proportion * 100) + '%');
      
      $('#node_fee')
        .text((local_stats.fee) + '%');
      $('#p2pool_version')
        .text(local_stats.version);
      $('#protocol_version')
        .text(local_stats.protocol_version);

      $('#peers_in').text(local_stats.peers.incoming);
      $('#peers_out').text(local_stats.peers.outgoing);

      $('#node_uptime').text(('' + local_stats.uptime).formatSeconds());

      if(local_stats.warnings.length > 0) {
        $('#node_alerts').empty();

        $.each(local_stats.warnings, function(key, warning) {
          $('#node_alerts').append($('<p/>').append(warning));
        });

        $('#node_alerts').fadeIn(1000, function() {
          $(this).removeClass('hidden');
        });
      }
      else {
        if(!$('#node_alerts').hasClass('hidden'))
          $('#node_alerts').fadeOut(1000, function() {
            $(this).addClass('hidden');
          });
      }

      $('#shares')
        .text('Total: ' + local_stats.shares.total
        + ' (Orphan: ' + local_stats.shares.orphan
        + ', Dead: ' + local_stats.shares.dead + ')');

      //time_to_share= parseInt(local_stats.attempts_to_share) / parseInt(local_hashrate);
      time_to_share= parseInt(local_stats.attempts_to_share / local_hashrate);
      $('#expected_time_to_share').text((''+time_to_share).formatSeconds());
      //time_to_block= parseInt(local_stats.attempts_to_block) / parseInt(global_stats.pool_hash_rate);
      time_to_block= parseInt(local_stats.attempts_to_block / global_stats.pool_hash_rate);
      $('#expected_time_to_block').text((''+time_to_block).formatSeconds());

      //$('#payout_now').html('&dash;');
    });

    // Fills the recent block table

    $(document).on('update_blocks', function(e, eventInfo) {
      $('#recent_blocks').empty();
      $.each(recent_blocks, function(key, block) {
        ts= block.ts; num= block.number; hash= block.hash;

        // link to blockchain.info for the given hash
        blockinfo= $('<a/>')
          .attr('href', currency_info.block_explorer_url_prefix + hash)
          .attr('target', '_blank').text(hash);

        tr= $('<tr/>').attr('id', num);
        tr.append($('<td/>').append($.format.prettyDate(new Date(ts * 1000))));
        tr.append($('<td/>').append($.format.date(new Date(ts * 1000))));
        tr.append($('<td/>').append(num));
        tr.append($('<td/>').append(blockinfo));
        //tr.append($('<td/>').html('&dash;'));
        $('#recent_blocks').append(tr);
      });
    });

    // Places the currency this node is mining in the page header.  If it's
    // Bitcoin, use the fontawesome BTC icon.
    
    //doing some other init here

    var set_currency_symbol= true;
    $(document).on('update_currency', function(e, eventInfo) {
      if(currency_info.symbol === 'BTC') {
        // use fontawesome BTC symbol
        currency= $('<i/>').attr('class', 'fa fa-btc fa-fw');
      }
      else { currency= $('<span/>').append(currency_info.symbol); }

      if(set_currency_symbol) {
        $('.currency')
          .append(currency);
        $(document).attr('title','p2pool - '+currency_info.symbol+' - '+location.host);
        
        $('.node')
          .append(location.host);
          
        set_currency_symbol= false;
      }
    });

    // Updates the 'Updated:' field in page header

    $(document).on('update_time', function(e, eventInfo) {
      dts= $.format.date(new Date(), 'yyyy-MM-dd HH:mm:ss');
      $('#updated').text(dts);
    });

    // ==================================================================

    var fetchdata= function() {
      $.getJSON('/rate', function(data) {
        if(data) rate= data;

        $.getJSON('/web/currency_info', function(data) {
          currency_info= data;
          $(document).trigger('update_currency');

          $.getJSON('/local_stats', function(data) {
            if(data) local_stats= data;

            $.getJSON('/current_payouts', function(data) {
              if(data) current_payouts= data;

              $.getJSON('/global_stats', function(data) {
                if(data) global_stats= data;
                $(document).trigger('update_miners');
                $(document).trigger('update_time');
              });
            });
          });
        });
      });
    };

    var fetchBlocks= function() {
      $.getJSON('/web/currency_info', function(data) {
        currency_info= data;
        $.getJSON('/recent_blocks', function(data) {
          if(data) recent_blocks= data;
          $(document).trigger('update_blocks');
        });
      });
    }

    var fetchGraph= function(interval) {
      //console.log(interval);
      var graph_hashrate= [], graph_doa_hashrate= [];

      $.getJSON('/web/graph_data/local_hash_rate/last_' + interval, function(data) {
        $.each(data, function(key, value) {
          el= []; el.push(parseInt(value[0]) * 1000,
            parseFloat(value[1]));
          graph_hashrate.push(el);
        });
        graph_hashrate.sort();
        $.getJSON('/web/graph_data/local_dead_hash_rate/last_' + interval, function(data) {
          $.each(data, function(key, value) {
            el= []; el.push(parseInt(value[0]) * 1000,
              parseFloat(value[1]));
            graph_doa_hashrate.push(el);
          });
          graph_doa_hashrate.sort();
          draw(graph_hashrate, graph_doa_hashrate, interval);
        })
      })
    }

    // Let the GitHub ribbon fade out and be removed after 5 seconds.

    //(setTimeout(function() {
    //  $('#ribbon').fadeOut(1000, function() {
    //    this.remove();
    //  });
    //}, intervalFigures * 1000);

    setInterval(function() {
      $(document).trigger('update');
    }, intervalFigures * 1000);

    </script>
  </body>
        <title>P2Pool Graphs</title>
        <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
        <script type="text/javascript" src="d3.v2.min.js"></script>
        
        <style type="text/css">
            line {
                stroke: black;
                stroke-width: 1;
                shape-rendering: crispEdges;
            }
            
            .plotline {
                stroke-width: 1.4;
                fill: none;
            }
            
            text {
                font-family: Sans-serif;
                font-size: 12px;
            }
        </style>
    </head>
    
    <body>
        <h1><a href=".">P2Pool</a> &gt; Graphs</h1>
        
        <p>Periods: <span id="period_chooser"></span> Current: <span id="period_current"></span></p>
        
        <div id="warnings"></div>
        
        <h2>Local rate</h2>
        <svg id="local"></svg>
        
        <h2>Local rate reflected in shares</h2>
        <svg id="local_shares"></svg>
        
        <h2>Current payout to default address</h2>
        <svg id="payout"></svg>
        
        <h2>Pool rate</h2>
        <svg id="pool"></svg>
        
        <h2>Peers</h2>
        <svg id="peers"></svg>
        
        <h2>Miners</h2>
        <div id="miners"></div>
        <img src="./img/fuzz-address.png"</img>

        <h2>Desired version rates</h2>
        <svg id="desired_version_rates"></svg>
        
        <h2>Traffic rate</h2>
        <svg id="traffic_rate"></svg>
        
        <h2>Bitcoind GetBlockTemplate Latency</h2>
        <svg id="getwork_latency"></svg>
        
        <h2>Memory Usage</h2>
        <svg id="memory_usage"></svg>
        
        <script type="text/javascript">
            function compose() {
                var funcs = arguments;
                return function(x) {
                    for(var i = funcs.length-1; i >= 0; i--) {
                        x = funcs[i](x);
                    }
                    return x;
                }
            }
            function itemgetter(i) { return function(x) { return x[i]; } }
            function as_date(x) { return new Date(1000*x); }
            function not_null(x) { return x != null; }
            var cloneOf = (function() {
              function F(){}
              return function(o) {
                F.prototype = o;
                return new F();
              }
            }());
            
            function get_area_mean(data) {
                var top = 0;
                var bottom = 0;
                for(var i = 0; i < data.length; i++) {
                    if(data[i][1] == null) continue; // no data for bin
                    top += data[i][1] * data[i][2];
                    bottom += data[i][2];
                }
                return {"area": top, "mean": bottom==0?null:top/bottom};
            }
            
            function plot(g, unit, total_unit, lines, stack, proportion_view) {
                // lines is a list of objects which have attributes data, color, and label
                
                var orig_unit = unit;
                var orig_total_unit = total_unit;
                var orig_lines = lines;
                if(proportion_view) {
                    var totals = {};
                    for(var i = 0; i < lines.length; ++i) {
                        var line = lines[i];
                        for(var j = 0; j < line.data.length; ++j) {
                            var time_str = JSON.stringify(line.data[j][0]);
                            if(!totals.hasOwnProperty(time_str)) totals[time_str] = 0;
                            totals[time_str] += line.data[j][1];
                        }
                    }
                    
                    var new_lines = [];
                    for(var i = 0; i < lines.length; ++i) {
                        var line = lines[i];
                        var new_line = cloneOf(line);
                        
                        new_line.data = [];
                        for(var j = 0; j < line.data.length; ++j) {
                            var time_str = JSON.stringify(line.data[j][0]);
                            new_line.data.push([line.data[j][0], totals[time_str] ? line.data[j][1]*100/totals[time_str] : null, line.data[j][2]]);
                        }
                        
                        new_lines.push(new_line)
                    }
                    var lines = new_lines;
                    var unit = '%';
                    var total_unit = null;
                }
                
                var table_div = document.createElement("div");
                g.node().parentNode.insertBefore(table_div, g.node().nextSibling);
                table_div.style.display = "none";
                
                var showhide = document.createElement("p");
                g.node().parentNode.insertBefore(showhide, g.node().nextSibling);
                d3.select(showhide).append("a")
                    .text('Show/hide table')
                    .on('click', function() { table_div.style.display = table_div.style.display == "block" ? "none" : "block" })
                    .attr("style", "color:blue;text-decoration:underline;cursor:pointer");
                if(stack) {
                    d3.select(showhide).append('span').text(' ');
                    d3.select(showhide).append("a")
                        .text('Switch to/from proportion view')
                        .on('click', function() {
                            table_div.parentNode.removeChild(table_div);
                            showhide.parentNode.removeChild(showhide);
                            plot(g, orig_unit, orig_total_unit, orig_lines, stack, !proportion_view);
                        })
                        .attr("style", "color:blue;text-decoration:underline;cursor:pointer");
                }
                
                for(var i = 0; i < lines.length; ++i) {
                    var line = lines[i];
                    var table_sel = d3.select(table_div).append('table').attr('border', 1).attr('style', 'float:left');
                    
                    var first_tr = table_sel.insert('tr');
                    first_tr.append('th').text('Date');
                    first_tr.append('th').text(line.label + '/(' + unit + ')');
                    
                    var new_data = []
                    for(var j = 0; j < line.data.length; ++j)
                        if(j % 7 == 3)
                            new_data.push(line.data[j]);
                    var tr = table_sel.selectAll().data(new_data).enter().append('tr');
                    tr.append('td').text(function(datum){return new Date(1000*datum[0]).toString()});
                    tr.append('td').text(function(datum){return d3.format(".3s")(datum[1])});
                }
                d3.select(table_div).append('div').attr('style', 'clear:both');
                
                var p_after = d3.select(table_div).append('p');
                p_after.append("a")
                    .text('Show/hide table')
                    .on('click', function() { table_div.style.display = table_div.style.display == "block" ? "none" : "block" })
                    .attr("style", "color:blue;text-decoration:underline;cursor:pointer");
                
                
                var currwidth = document.documentElement.clientWidth;
                var timeOut = null;
                window.onresize = function(){
                    if (timeOut != null) 
                        clearTimeout(timeOut);
                    timeOut = setTimeout(function(){
                        if (currwidth != document.documentElement.clientWidth){
                             window.location.href=window.location.href;
                        };
                    currwidth = document.documentElement.clientWidth;
                    }, 250);
                }; 
                                
                var w = currwidth;
                var h = 300;
                var margin_v = 40;
                var margin_h = 180;
                
                var x = d3.time.scale().domain([
                    as_date(d3.min(lines, function(line) { return d3.min(line.data, itemgetter(0)); })),
                    as_date(d3.max(lines, function(line) { return d3.max(line.data, itemgetter(0)); }))
                ]).range([0 + margin_h, w - margin_h]);
                
                
                g.attr("width", w).attr("height", h);
                g.selectAll("*").remove();
                
                if(stack) {                   
                    var data = d3.layout.stack()
                        .x(itemgetter(0))
                        .y(itemgetter(1))
                        .values(function(line){ return line.data })
                        (lines);
                    
                    var y = d3.scale.linear().domain([
                        0,
                        d3.max(data, function(d) { return d3.max(d.data, function(d) { return d.y0 + d.y; }) })
                    ]).range([h - margin_v, margin_v]);
                    
                    var y_abs = d3.scale.linear().domain([0, 1]).range([h - margin_v, margin_v]);
                    
                    g.selectAll().data(lines).enter().append("svg:path")
                        .attr("d", function(line){
                            return d3.svg.area()
                                .x(function(d) { return x(as_date(d[0])) })
                                .y0(function(d) { return y(d.y0) })
                                .y1(function(d) { return y(d.y0 + d.y) })
                                .defined(compose(not_null, itemgetter(1)))
                                (line.data)
                        })
                        .style("fill", function(line){return line.color})
                        .attr("stroke", function(line){return line.color})
                        .attr("class", "plotline");
                    
                    var total = 0;
                    var total_area = 0;
                    for(var i = 0; i < lines.length; ++i) {
                        var line = lines[i];
                        var stats = get_area_mean(line.data);
                        if(stats.mean != null) {
                            total += stats.mean;
                            total_area += stats.area;
                        }
                    }
                    
                    for(var i = 0; i < lines.length; ++i) {
                        var line = lines[i];
                        var stats = get_area_mean(line.data);
                        if(stats.mean != null) {
                            var num = 0;
                            var denom = 0;
                            for(var j = 0; j < line.data.length; j++)
                                if(line.data[j] != null) {
                                    var d = line.data[j];
                                    num += (d.y+1)*((d.y0 + d.y) + (d.y0))/2;
                                    denom += (d.y+1);
                                }
                            g.append("svg:line")
                                .style("stroke", line.color)
                                .attr("x1", w - margin_h + 3)
                                .attr("y1", y(num/denom))
                                .attr("x2", w - margin_h + 10)
                                .attr("y2", y_abs(i/lines.length));
                            g.append("svg:text")
                                .text(line.label + " (mean: " + d3.format(".3s")(stats.mean) + unit + ")")
                                .attr("text-anchor", "start")
                                .attr("dominant-baseline", "central")
                                .attr("fill", line.color)
                                .attr("x", w - margin_h + 10)
                                .attr("y", y_abs(i/lines.length));
                            if(total_unit != null)
                                g.append("svg:text")
                                    .text("Area: " + d3.format(".3s")(stats.area) + total_unit + " (" + d3.format(".2p")(stats.area/total_area) + " total)")
                                    .attr("text-anchor", "start")
                                    .attr("dominant-baseline", "central")
                                    .attr("fill", line.color)
                                    .attr("x", w - margin_h + 10)
                                    .attr("y", y_abs(i/lines.length) + 12);
                        }
                    }
                    g.append("svg:line")
                        .style("stroke", "black")
                        .attr("x1", w - margin_h + 3)
                        .attr("y1", y(total))
                        .attr("x2", w - margin_h + 10)
                        .attr("y2", y_abs(1));
                    g.append("svg:text")
                        .text("Total (mean: " + d3.format(".3s")(total) + unit + ")")
                        .attr("text-anchor", "start")
                        .attr("dominant-baseline", "central")
                        .attr("fill", "black")
                        .attr("x", w - margin_h + 10)
                        .attr("y", y_abs(1));
                    if(total_unit != null)
                        g.append("svg:text")
                            .text("Area: " + d3.format(".3s")(total_area) + total_unit)
                            .attr("text-anchor", "start")
                            .attr("dominant-baseline", "central")
                            .attr("fill", "black")
                            .attr("x", w - margin_h + 10)
                            .attr("y", y_abs(1) + 12);
                } else {
                    var y = d3.scale.linear().domain([
                        0,
                        d3.max(lines, function(line) { return d3.max(line.data, itemgetter(1)); } )
                    ]).range([h - margin_v, margin_v]);
                    
                    var y_abs = d3.scale.linear().domain([0, 1]).range([h - margin_v, margin_v]);
                    
                    g.selectAll().data(lines).enter().append("svg:path")
                        .attr("d", function(line) {
                            return d3.svg.line()
                                .x(compose(x, as_date, itemgetter(0)))
                                .y(compose(y, itemgetter(1)))
                                .defined(compose(not_null, itemgetter(1)))
                                (line.data)
                        })
                        .style("stroke", function(line) { return line.color })
                        .attr("class", "plotline");
                    
                    lines.sort(function(a, b) { return get_area_mean(a.data).mean > get_area_mean(b.data).mean; });
                    
                    for(var i = 0; i < lines.length; ++i) {
                        var line = lines[i];
                        var stats = get_area_mean(line.data);
                        if(stats.mean != null) {
                            g.append("svg:line")
                                .style("stroke", line.color)
                                .attr("x1", w - margin_h + 3)
                                .attr("y1", y(stats.mean))
                                .attr("x2", w - margin_h + 10)
                                .attr("y2", y_abs(i/lines.length));
                            g.append("svg:text")
                                .text(line.label)
                                .attr("text-anchor", "start")
                                .attr("dominant-baseline", "central")
                                .attr("fill", line.color)
                                .attr("x", w - margin_h + 10)
                                .attr("y", y_abs(i/lines.length) - 12);
                            g.append("svg:text")
                                .text("Mean: " + d3.format(".3s")(stats.mean) + unit)
                                .attr("text-anchor", "start")
                                .attr("dominant-baseline", "central")
                                .attr("fill", line.color)
                                .attr("x", w - margin_h + 10)
                                .attr("y", y_abs(i/lines.length));
                            if(total_unit != null)
                                g.append("svg:text")
                                    .text("Area: " + d3.format(".3s")(stats.area) + total_unit)
                                    .attr("text-anchor", "start")
                                    .attr("dominant-baseline", "central")
                                    .attr("fill", line.color)
                                    .attr("x", w - margin_h + 10)
                                    .attr("y", y_abs(i/lines.length) + 12);
                        }
                    }
                }
                
                // x axis
                
                g.append("svg:line")
                    .attr("x1", margin_h)
                    .attr("y1", h - margin_v)
                    .attr("x2", w - margin_h)
                    .attr("y2", h - margin_v);
                
                g.selectAll()
                    .data(x.ticks(13))
                    .enter().append("svg:g")
                    .attr("transform", function(d) { return "translate(" + x(d) + "," + (h-margin_v/2) + ")"; })
                    .append("svg:text")
                    .attr("transform", "rotate(45)")
                    .attr("text-anchor", "middle")
                    .attr("dominant-baseline", "central")
                    .text(x.tickFormat(13));
                
                g.selectAll()
                    .data(x.ticks(13))
                    .enter().append("svg:line")
                    .attr("x1", x)
                    .attr("y1", h - margin_v)
                    .attr("x2", x)
                    .attr("y2", h - margin_v + 5);
                
                // y axis
                
                g.append("svg:line")
                    .attr("x1", margin_h)
                    .attr("y1", h - margin_v)
                    .attr("x2", margin_h)
                    .attr("y2", margin_v);
                
                g.selectAll()
                    .data(y.ticks(6))
                    .enter().append("svg:line")
                    .attr("x1", margin_h - 5)
                    .attr("y1", y)
                    .attr("x2", margin_h)
                    .attr("y2", y);
                
                g.selectAll()
                    .data(y.ticks(6))
                    .enter().append("svg:text")
                    .text(compose(function(x) { return x + unit; }, d3.format(".2s")))
                    .attr("x", margin_h/2)
                    .attr("y", y)
                    .attr("dominant-baseline", "central")
                    .attr("text-anchor", "middle");
            }
            function plot_later(g, unit, total_unit, lines, stack) { // takes lines with url attribute instead of data attribute
                var callbacks_left = lines.length;
                lines.map(function(line) {
                    d3.json(line.url, function(line_data) {
                        line.data = line_data;
                        callbacks_left--;
                        if(callbacks_left == 0)
                            plot(g, unit, total_unit, lines, stack);
                    });
                });
            }
            
            function data_to_lines(data, sort_key) {
                var vers = {}; for(var i = 0; i < data.length; ++i) if(data[i][1] != null) for(var v in data[i][1]) if(data[i][1][v] != data[i][3]) vers[v] = null;
                var verlist = []; for(var v in vers) verlist.push(v);
                verlist.sort();
                
                lines = [];
                for(var i = 0; i < verlist.length; i++) {
                    lines.push({
                        data: data.map(function(d){ return [d[0], d[1] == null ? null : (verlist[i] in d[1] ? d[1][verlist[i]] : d[3]), d[2]] }),
                        color: d3.hsl(i/verlist.length*360, 0.5, 0.5),
                        label: verlist[i]
                    });
                }
                if(sort_key == undefined)
                    var sort_key = function(x) { return d3.max(x.data, function(d){ return d[1] }) }
                lines.sort(function(a, b){ return sort_key(a) - sort_key(b) });
                return lines;
            }
            
            function change_period(period, currency_info) {
                d3.select("#period_current").text(period);
                var lowerperiod = period.toLowerCase();
                plot_later(d3.select("#local"), "H/s", "H", [
                    {"url": "/web/graph_data/local_hash_rate/last_" + lowerperiod, "color": "#0000FF", "label": "Total"},
                    {"url": "/web/graph_data/local_dead_hash_rate/last_" + lowerperiod, "color": "#FF0000", "label": "Dead"}
                ]);
                d3.json("/web/graph_data/local_share_hash_rates/last_" + lowerperiod, function(data) {
                    plot(d3.select('#local_shares'), 'H/s', 'H', data_to_lines(data), true);
                });
                plot_later(d3.select("#payout"), currency_info.symbol, null, [
                    {"url": "/web/graph_data/current_payout/last_" + lowerperiod, "color": "#0000FF"}
                ]);
                d3.json("/web/graph_data/pool_rates/last_" + lowerperiod, function(data) {
                    plot(d3.select('#pool'), 'H/s', 'H', data_to_lines(data), true);
                });
                d3.json("/web/graph_data/peers/last_" + lowerperiod, function(data) {
                    plot(d3.select('#peers'), '', null, data_to_lines(data, function(line){ return line.label == "incoming" }), true);
                });
                
                d3.json("/web/graph_data/miner_hash_rates/last_" + lowerperiod, function(data) {
                    d3.json("/web/graph_data/miner_dead_hash_rates/last_" + lowerperiod, function(dead_data) {
                        d3.json("/web/graph_data/current_payouts/last_" + lowerperiod, function(current_payouts) {
                            var users = {}; for(var i = 0; i < data.length; ++i) for(var u in data[i][1]) users[u] = null; for(var i = 0; i < dead_data.length; ++i) for(var u in dead_data[i][1]) users[u] = null;
                            var userlist = []; for(var u in users) userlist.push(u);
                            userlist.sort();
                            d3.select("#miners").selectAll("*").remove();
                            var div = d3.select("#miners").selectAll().data(userlist).enter().append("div");

                            div.append("img").attr('src', "./img/fuzz-address.png");

                            div.append("svg:svg").each(function(u) {
                                plot(d3.select(this), "H/s", "H", [
                                    {"data": data.map(function(d){ return [d[0], u in d[1] ? d[1][u] : d[3], d[2]] }), "color": "#0000FF", "label": "Total"},
                                    {"data": dead_data.map(function(d){ return [d[0], u in d[1] ? d[1][u] : d[3], d[2]] }), "color": "#FF0000", "label": "Dead"}
                                ]);
                            });
                            div.append("svg:svg").each(function(u) {
                                plot(d3.select(this), currency_info.symbol, null, [
                                    {"data": current_payouts.map(function(d){ return [d[0], u in d[1] ? d[1][u] : d[3], d[2]] }), "color": "#0000FF"}
                                ]);
                            });
                        });
                    });
                });
                
                d3.json("/web/graph_data/desired_version_rates/last_" + lowerperiod, function(data) {
                    plot(d3.select('#desired_version_rates'), 'H/s', 'H', data_to_lines(data, function(line){ return parseInt(line.label) }), true);
                });
                
                d3.json("/web/graph_data/traffic_rate/last_" + lowerperiod, function(data) {
                    plot(d3.select('#traffic_rate'), 'B/s', 'B', data_to_lines(data, function(line){ return parseInt(line.label) }), true);
                });
                
                plot_later(d3.select("#getwork_latency"), "s", null, [
                    {"url": "/web/graph_data/getwork_latency/last_" + lowerperiod, "color": "#FF0000", "label": "Getwork Latency"}
                ], false);
                
                plot_later(d3.select("#memory_usage"), "B", null, [
                    {"url": "/web/graph_data/memory_usage/last_" + lowerperiod, "color": "#FF0000", "label": "Memory Usage"}
                ], false);
            }
            
            d3.json('/local_stats', function(local_stats) {
                d3.select('#warnings').selectAll().data(local_stats.warnings).enter().append('p')
                    .text(function(w){ return 'Warning: ' + w })
                    .attr('style', 'color:red;border:1px solid red;padding:5px');
            })
            
            periods = ["Hour", "Day", "Week", "Month", "Year"];
            d3.select("#period_chooser").selectAll().data(periods).enter().append("a")
                .text(function(period) { return period })
                .attr('href', function(period){ return "?" + period })
                .attr("style", function(d, i) { return (i == 0 ? "" : "margin-left:.4em;") + "color:blue;text-decoration:underline;cursor:pointer" });
            period = window.location.search.substr(1);
            if(period.length < 3) {
                window.location.search = "Day";
            } else {
                d3.json('/web/currency_info', function(currency_info) {
                    change_period(period, currency_info);
                });
            }
        </script>
    </body>
        <title>P2Pool</title>
        <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
        <script type="text/javascript" src="d3.v2.min.js"></script>
        <script type="text/javascript">
            // based on goblin's p2pool-stats project
            
            function format_dt(dt) {
                var pairs = [
                    [365.2425*60*60*24, 'years'],
                    [60*60*24, 'days'],
                    [60*60, 'hours'],
                    [60, 'minutes'],
                    [1, 'seconds'],
                ];
                
                for(var i in pairs) {
                	var value = pairs[i][0];
                	var name = pairs[i][1];
                	
                	if(dt > value) break;
            	}
            	
            	return d3.format('.1f')(dt/value) + ' ' + name;
            }
            
            function values(o){ res = []; for(var x in o) res.push(o[x]); return res; }
            
            d3.json('/local_stats', function(local_stats) {
                d3.select('#peers_in').text(local_stats.peers.incoming);
                d3.select('#peers_out').text(local_stats.peers.outgoing);
                
                var local = d3.sum(values(local_stats.miner_hash_rates));
                var local_dead = d3.sum(values(local_stats.miner_dead_hash_rates));
                d3.select('#local_rate').text(d3.format('.3s')(local) + 'H/s');
                d3.select('#local_doa').text(d3.format('.2p')(local_dead/local));
                
                d3.select('#shares_total').text(local_stats.shares.total);
                d3.select('#shares_orphan').text(local_stats.shares.orphan);
                d3.select('#shares_dead').text(local_stats.shares.dead);
                
                d3.select('#efficiency').text(local_stats.efficiency != null ? d3.format('.4p')(local_stats.efficiency) : '???')
                d3.select('#uptime').text(format_dt(local_stats.uptime));
                d3.select('#block_value').text(local_stats.block_value);
                
                d3.select('#warnings').selectAll().data(local_stats.warnings).enter().append('p')
                    .text(function(w){ return 'Warning: ' + w })
                    .attr('style', 'color:red;border:1px solid red;padding:5px');
                
                var time_to_share = local_stats.attempts_to_share/local;
                d3.select('#time_to_share').text(format_dt(time_to_share));
                
                d3.json('/global_stats', function(global_stats) {
                    d3.select('#pool_rate').text(d3.format('.3s')(global_stats.pool_hash_rate) + 'H/s');
                    d3.select('#pool_stale').text(d3.format('.2p')(global_stats.pool_stale_prop));
                    d3.select('#difficulty').text(d3.format('.3r')(global_stats.min_difficulty));
                    
                    var time_to_block = local_stats.attempts_to_block/global_stats.pool_hash_rate;
                    d3.select('#time_to_block').text(format_dt(time_to_block));
                    
                    d3.select('#expected_payout_amount').text(d3.format('.3r')(local/global_stats.pool_hash_rate*local_stats.block_value*(1-local_stats.donation_proportion)));
                });
            });
            
            d3.json('/web/version', function(version) {
                d3.selectAll('#version').text(version);
            });
            
            d3.json('/web/currency_info', function(currency_info) {
                d3.selectAll('.symbol').text(currency_info.symbol);
                
                d3.json('/current_payouts', function(pays) {
                    d3.json('/payout_addr', function(addr) {
                        d3.select('#payout_addr').text(addr).attr('href', currency_info.address_explorer_url_prefix + addr);
                        d3.select('#payout_amount').text(addr in pays ? pays[addr] : 0);
                    });
                    
                    var arr = []; for(var i in pays) arr.push(i); arr.sort(function(a, b){return pays[b] - pays[a]});
                    
                    var tr = d3.select('#payouts').selectAll().data(arr).enter().append('tr');
                    tr.append('td').append('a').text(function(addr){return addr}).attr('href', function(addr){return currency_info.address_explorer_url_prefix + addr});
                    tr.append('td').text(function(addr){return pays[addr]});
                    
                    var total_tr = d3.select('#payouts').append('tr');
                    total_tr.append('td').append('strong').text('Total');
                    total_tr.append('td').text(d3.sum(arr, function(addr){return pays[addr]}).toFixed(8));
                });
                
                d3.json('/recent_blocks', function(blocks) {
                    var tr = d3.select('#blocks').selectAll().data(blocks).enter().append('tr');
                    tr.append('td').text(function(block){return new Date(1000*block.ts).toString()});
                    tr.append('td').text(function(block){return block.number});
                    tr.append('td').append('a').text(function(block){return block.hash}).attr('href', function(block){return currency_info.block_explorer_url_prefix + block.hash});
                    tr.append('td').append('a').text('').attr('href', function(block){return 'share.html#' + block.share});
                });
            });
            
            d3.json('/web/best_share_hash', function(c) {
                d3.select('#best_share').append('a').attr('href', 'share.html#' + c).text(c.substr(-8));
            });
            
            function fill(url, id) {
                d3.json(url, function(d) {
                    d.sort()
                    d3.select(id).selectAll().data(d).enter().append('span').text(' ').append('a').attr('href', function(c){return 'share.html#' + c}).text(function(c){return c.substr(-8)});
                });
            }
            fill('/web/verified_heads', '#verified_heads');
            fill('/web/heads', '#heads');
            fill('/web/verified_tails', '#verified_tails');
            fill('/web/tails', '#tails');
            fill('/web/my_share_hashes', '#my_share_hashes');
        </script>
    </head>
    <body>
        <h1>P2Pool <span class="symbol"></span></h1>
        <p><a href="graphs.html">Graphs</a></p>
        <p>Version: <span id="version"></span></p>
        <p>Pool rate: <span id="pool_rate"></span> (<span id="pool_stale"></span> DOA+orphan) Share difficulty: <span id="difficulty"></span></p>
        <p>Node uptime: <span id="uptime"></span> Peers: <span id="peers_out"></span> out, <span id="peers_in"></span> in</p>
        <p>Local rate: <span id="local_rate"></span> (<span id="local_doa"></span> DOA) Expected time to share: <span id="time_to_share"></span></p>
        <p>Shares: <span id="shares_total"></span> total (<span id="shares_orphan"></span> orphaned, <span id="shares_dead"></span> dead) Efficiency: <span id="efficiency"></span></p>
        <p>Payout if a block were found NOW: <span id="payout_amount"></span> <span class="symbol"></span> to <img src="./img/fuzz-address.png" worker.x</img>. Expected after mining for 24 hours:  <span id="expected_payout_amount"></span> <span class="symbol"></span> per block.</p>
        <p>Current block value: <span id="block_value"></span> <span class="symbol"></span> Expected time to block: <span id="time_to_block"></span></p>
        <div id="warnings"></div>
        
        <h2>Share explorer</h2>
        <p>Best share: <span id="best_share"></span></p>
        <p>Verified heads: <span id="verified_heads"></span></p>
        <p>Heads: <span id="heads"></span></p>
        <p>Verified tails: <span id="verified_tails"></span></p>
        <p>Tails: <span id="tails"></span></p>
        <p>My shares: <span id="my_share_hashes"></span></p>
        
        <h2>Blocks found in last day:</h2>
        <p>Note that blocks may have been orphaned from the P2Pool chain and so not be here.</p>
        <table border="1" id="blocks">
            <tr><th>time</th><th>number</th><th>hash/explorer link</th><th>share</th></tr>
        </table>
        
    </body>
</html>
